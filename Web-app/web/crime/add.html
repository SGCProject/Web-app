<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="import" type="text/html" href="../map/latlng_picker.html" />
        <!--<link href="../js/libs/jqueryui/jquery-ui.css" rel="stylesheet" type="text/css"/>-->
        <!-- Include Google Map -->
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC1j-b_PdubJrPoK9rX26VKRnWUpR4nd9c"></script>
        <!--<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&amp;language=en">-->

        <!-- Include gMap3 -->
        <script src="../js/libs/gmap3/gmap3.min.js" type="text/javascript"></script>
        <script>
            $(function () {
                var query = window.location.search.substring(1);
                var pair = query.split("=");
                var pk = pair[1];

                if (pk != 'undefined') {
                    $.post(url + "Crime/query", {'pk': pk}, function (data) {
                        if (data.Result == "OK") {
                            var date = data.Record.crime_date.split("-");
                            $('#datepicker').val(date[0] + "/" + date[1] + "/" + date[2]);
                            
                            $('#txtLat').val(data.Record.crime_lat);
                            $('#txtLng').val(data.Record.crime_lng);
                            $('#crime_detail').val(data.Record.crime_detail);
                        } else {
                            alert(data.Message);
                        }
                    });
                }

                $('#butLatLng').on("click", function () {
                    $('#dialogLatlngPicker').dialog("open");
                });

                $('#dialogLatlngPicker').on("dialogclose", function (event, ui) {
                    $('#txtLat').val(latLng.k);
                    $('#txtLng').val(latLng.B);
                });
                $('#datepicker').datepicker();

                $('#submit').on("click", function () {
                    $.post(
                            url + "Crime/insert",
                            $('form').serializeArray(),
                            function (data) {
                                console.log(data);
                            }
                    );
                });
            });
        </script>
    </head>
    <body>
        <form>
            <div>
                วันที่เกิดเหตุ<input type="text" id="datepicker" name="crime_date" />
            </div>       
            <div>
                ช่วงเวลาเกิดเหตุ
                <select class="showLookup" itemid="Time" name="time_pk">
                    <option value="[pk]" >[time_lange]</option>
                </select>
            </div>
            <div>
                <input type="text" id="txtLat" name="crime_lat" />
                <input type="text" id="txtLng" name="crime_lng" />
                <input type="button" id="butLatLng" value="แผนที่" />  
            </div>
            <div>
                รายละเอียด
                <textarea name="crime_detail" id="crime_detail" ></textarea>
            </div>
            <div>
                ระดับการเข้าถึงคดี
            </div>
            <div>
                ประเภทคดี
                <select class="showLookup" itemid="Type" name="type_pk" >
                    <option value="[pk]" >[name]</option>
                </select>
            </div>
            <div>
                เขตพื้นที่
                <select class="showLookup" itemid="Area" name="area_pk">
                    <option value="[pk]" >[name]</option>
                </select>
            </div>
            <div>
                ประเภทสถานที่
                <select class="showLookup" itemid="Place" name="place_pk">
                    <option value="[pk]" >[name]</option>
                </select>
            </div>
            <div>
                <input id="submit" type="button" value="บันทึก" />
            </div>
        </form>
        <div id="dialogLatlngPicker" >
            <div id="gmapLatLngPicker" class="gmap3"></div>
        </div>
    </body>
    <script src="../js/libs/my.js" type="text/javascript"></script>
</html>
